{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport AdminLayoutHoc from \"../../components/Layout/AdminLayoutHoc\";\nimport Link from 'next/link';\nimport React, { useState, useEffect, Component } from \"react\";\nimport Router from \"next/router\";\nimport Cookies from \"js-cookie\";\nimport { ServiceUser } from \"../../service\";\nimport Dialog from 'react-bootstrap-dialog';\nexport default class AddUser extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleSwitchChange\", nr => () => {\n      let switchNumber = `switch${nr}`;\n      this.setState({\n        [switchNumber]: !this.state[switchNumber]\n      });\n    });\n\n    this.state = {\n      auth: {\n        username: \"\",\n        password: \"\",\n        role: \"3\",\n        rolename: \"User\"\n      },\n      username: \"\",\n      password: \"\",\n      confirmpassword: \"\",\n      role: \"3\",\n      rolename: \"User\",\n      errorMessage: \"\",\n      datas: [],\n      role_data: [],\n      mydatas: {},\n      value: \"User\",\n      user_enable: true,\n      switch1: true,\n      userid: Cookies.get(\"userid\")\n    };\n    this.handleSelectChange = this.handleSelectChange.bind(this);\n    this.handleToggleChange = this.handleToggleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.setErrorMsg = this.setErrorMsg.bind(this);\n    this.onClick = this.onClick.bind(this);\n    this.onConfirmClick = this.onConfirmClick.bind(this);\n    this.handleResetSubmit = this.handleResetSubmit.bind(this);\n    this.onSearchLevel = this.onSearchLevel.bind(this);\n    this.onSearchLevelname = this.onSearchLevelname.bind(this);\n  }\n\n  onSearchLevel(level_name) {\n    console.log('get myrole');\n    const myrole = this.state.role_data.filter(role => {\n      return role.user_level_name == level_name;\n    });\n    const user_level_id = myrole.map((role, index) => {\n      return role.user_level_id;\n    });\n    return user_level_id[0];\n  }\n\n  onSearchLevelname(level_id) {\n    console.log('get myrole');\n    const myrole = this.state.role_data.filter(role => {\n      return role.user_level_id == level_id;\n    });\n    const user_level_name = myrole.map((role, index) => {\n      return role.user_level_name;\n    }); //console.log('myrole:' + myrole);\n\n    return user_level_name;\n  }\n\n  onClick() {\n    this.dialog.showAlert('Hello Dialog!');\n  }\n\n  handleResetSubmit() {\n    Router.push(\"/users\");\n  }\n\n  onConfirmClick() {\n    this.dialog.show({\n      title: 'Slot Admin confirm',\n      body: 'Are you sure?',\n      actions: [Dialog.CancelAction(() => {\n        dialog.hide();\n      }), Dialog.OKAction(() => {})],\n      bsSize: 'small',\n      onHide: dialog => {\n        dialog.hide();\n        console.log('closed by clicking background.');\n      }\n    });\n  }\n\n  async handleSubmit() {\n    try {\n      if (this.state.username !== \"\" && this.state.user_email !== \"\") {\n        if (this.state.password === this.state.confirmpassword) {\n          this.setState({\n            role: this.onSearchLevel(this.state.rolename)\n          });\n          console.log('role : ' + this.state.role);\n          let user_enable = 0;\n\n          if (this.state.switch1) {\n            user_enable = 1;\n          }\n\n          let a = {};\n\n          if (this.state.password !== \"\") {\n            a = {\n              user_name: this.state.username,\n              user_pass: this.state.password,\n              user_email: this.state.user_email,\n              user_level: this.state.role,\n              user_status: user_enable,\n              add_date: \"\",\n              last_login: \"\"\n            };\n          } else {\n            a = {\n              user_name: this.state.username,\n              user_email: this.state.user_email,\n              user_level: this.state.role,\n              user_status: user_enable\n            };\n          }\n\n          console.log('data update : ' + a.role);\n          const res = await ServiceUser.editUser(a, this.state.userid);\n          console.log('res : ' + res.data);\n\n          if (res.data.status === 2000) {\n            console.log('Edit User Success!!!');\n            this.dialog.show({\n              title: 'Spiderbot information',\n              body: 'Edit a user : ' + a.user_name + ' is successfully.',\n              actions: [Dialog.OKAction(() => {\n                //action('ok button was clicked!')()\n                Router.push(\"/users\");\n              })]\n            });\n          } else {\n            this.dialog.showAlert(res.data.message);\n            this.setErrorMsg(res.data.msg);\n          }\n        } else {\n          this.dialog.showAlert('กรุณา confirm password ให้ถูกต้อง!');\n        }\n      } else {\n        this.dialog.showAlert('กรุณาใส่ข้อมูลให้ครบ ก่อนกดปุ่ม Save!');\n      }\n    } catch (error) {\n      this.dialog.showAlert(error);\n      console.error(\"An unexpected error happened occurred:\", error);\n      this.setErrorMsg(error.message);\n    } //e.preventDefault();\n\n  }\n\n  handleSelectChange(e) {\n    console.log(\"e.target.value :\" + e.target.value);\n    this.setState({\n      rolename: e.target.value\n    });\n  }\n\n  handleToggleChange(e) {\n    console.log(\"e.target.value :\" + e.target.value);\n    this.setState({\n      user_enable: e.target.value\n    });\n  }\n\n  setErrorMsg(msg) {\n    console.log(msg);\n    this.setState({\n      errorMessage: msg\n    });\n  }\n\n  componentDidMount() {\n    if (!Cookies.get(\"user\")) {\n      Router.push(\"/\");\n    }\n\n    ServiceUser.listSystemRole().then(res => {\n      console.log(\"res data=>\" + res.data);\n      const {\n        data,\n        status\n      } = res.data;\n      console.log(\"status=>\" + status);\n\n      if (status === 2000) {\n        console.log(\"data :=>\" + JSON.stringify(data));\n        this.setState({\n          role_data: data\n        });\n        console.log(\"userid=>\" + this.state.userid);\n        ServiceUser.getUserFromId(this.state.userid).then(res => {\n          //console.log(\"res data=>\" + res.data);\n          const {\n            data,\n            status\n          } = res.data; //console.log(\"status=>\" + status);\n\n          if (status === 2000) {\n            //this.setState({ data: data });\n            console.log(\"edit data =>\" + JSON.stringify(data));\n            const {\n              user_name,\n              user_email,\n              user_level,\n              user_status\n            } = data[0];\n            console.log(\"user_name=>\" + user_name);\n            console.log(\"user_email=>\" + user_email);\n            console.log(\"user_level=>\" + user_level);\n            console.log(\"user_status=>\" + user_status);\n            this.setState({\n              username: user_name,\n              user_email: user_email,\n              rolename: this.onSearchLevelname(user_level),\n              switch1: Boolean(Number(user_status))\n            });\n          } else {\n            this.setErrorMsg(res.data.message);\n            this.dialog.showAlert(res.data.message);\n          }\n        });\n      } else {\n        //this.setErrorMsg(res.data.msg);\n        this.dialog.showAlert(res.data.message);\n      }\n    });\n  }\n\n  render() {\n    const element = __jsx(\"div\", {\n      className: \"toggle-switch\"\n    }, __jsx(\"input\", {\n      type: \"checkbox\",\n      \"data-toggle\": \"toggle\",\n      \"data-on\": \"Ready\",\n      \"data-off\": \"Not Ready\",\n      \"data-onstyle\": \"success\",\n      \"data-offstyle\": \"danger\"\n    }));\n\n    return __jsx(AdminLayoutHoc, {\n      contentTitle: 'Edit User',\n      contentTitleButton: __jsx(\"i\", {\n        className: \"fa fa-2x fa-user-plus\"\n      }),\n      url: this.props.url\n    }, __jsx(\"div\", {\n      className: \"offset-md-0\"\n    }, __jsx(\"div\", {\n      className: \"card\"\n    }, __jsx(\"div\", {\n      className: \"card-header\"\n    }), __jsx(\"form\", {\n      className: \"form-horizontal\"\n    }, __jsx(\"div\", {\n      className: \"card-body\"\n    }, __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"div\", {\n      className: \"col-sm-12\"\n    }, __jsx(\"div\", {\n      className: \"input-group mb-3 input-group-sm\"\n    }, __jsx(\"div\", {\n      className: \"input-group-prepend\"\n    }, __jsx(\"span\", {\n      className: \"input-group-text\"\n    }, \"Username\")), __jsx(\"input\", {\n      type: \"text\",\n      className: \"form-control\" //placeholder=\"Username\"\n      ,\n      id: \"validation-ex1\",\n      onChange: e => this.setState({\n        username: e.target.value\n      }),\n      value: this.state.username,\n      required: true\n    })))), __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"div\", {\n      className: \"col-sm-12\"\n    }, __jsx(\"div\", {\n      className: \"input-group mb-3 input-group-sm\"\n    }, __jsx(\"div\", {\n      className: \"input-group-prepend\"\n    }, __jsx(\"span\", {\n      className: \"input-group-text\"\n    }, \"Email\")), __jsx(\"input\", {\n      type: \"text\",\n      className: \"form-control \",\n      id: \"validation-ex2\" //placeholder=\"Email\"\n      ,\n      onChange: e => this.setState({\n        user_email: e.target.value\n      }),\n      value: this.state.user_email,\n      required: true\n    })))), __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"label\", {\n      htmlFor: \"select-1\",\n      className: \"col-sm-12 control-label\"\n    }, \"Select user level\"), __jsx(\"div\", {\n      className: \"col-sm-offset-2 col-sm-12\"\n    }, __jsx(\"select\", {\n      id: \"select-1\",\n      className: \"form-control\",\n      value: this.state.rolename,\n      onChange: this.handleSelectChange\n    }, this.state.role_data.map((data, index) => {\n      return __jsx(\"option\", {\n        key: index,\n        value: data.user_level_name\n      }, data.user_level_name);\n    })))), __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"div\", {\n      className: \"col-sm-12\"\n    }, __jsx(\"div\", {\n      className: \"input-group mb-3 input-group-sm\"\n    }, __jsx(\"div\", {\n      className: \"input-group-prepend\"\n    }, __jsx(\"span\", {\n      className: \"input-group-text\"\n    }, \"Password\")), __jsx(\"input\", {\n      type: \"password\",\n      className: \"form-control \",\n      id: \"validation-ex3\" //placeholder=\"Password\"\n      ,\n      onChange: e => this.setState({\n        password: e.target.value\n      }),\n      value: this.state.password,\n      required: true\n    })))), __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"div\", {\n      className: \"col-sm-12\"\n    }, __jsx(\"div\", {\n      className: \"input-group mb-3 input-group-sm\"\n    }, __jsx(\"div\", {\n      className: \"input-group-prepend\"\n    }, __jsx(\"span\", {\n      className: \"input-group-text\"\n    }, \"Confirm Password\")), __jsx(\"input\", {\n      type: \"password\",\n      className: \"form-control \",\n      id: \"validation-ex4\" //placeholder=\"Confirm Password\"\n      ,\n      onChange: e => this.setState({\n        confirmpassword: e.target.value\n      }),\n      value: this.state.confirmpassword,\n      required: true\n    })))), __jsx(\"div\", {\n      className: \"form-group\"\n    }, __jsx(\"div\", {\n      className: \"col-sm-12\"\n    }, __jsx(\"label\", {\n      class: \"switch\"\n    }, __jsx(\"input\", {\n      type: \"checkbox\",\n      onChange: this.handleSwitchChange(1),\n      checked: this.state.switch1\n    }), __jsx(\"span\", {\n      class: \"slider round\"\n    })), __jsx(\"label\", {\n      className: \"control-label\"\n    }, \"\\xA0\\xA0Enabled\"))))), __jsx(\"div\", {\n      className: \"card-footer\"\n    }, __jsx(\"div\", {\n      className: \"d-inline-block btn-block\"\n    }, __jsx(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.handleResetSubmit\n    }, \"Back\"), __jsx(\"button\", {\n      className: \"btn btn-info float-right\",\n      onClick: this.handleSubmit\n    }, \"Save\")))), __jsx(Dialog, {\n      ref: el => {\n        this.dialog = el;\n      }\n    })));\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}